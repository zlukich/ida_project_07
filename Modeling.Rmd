---
title: "General_Task_07"
author: "Group07"
date: '2022-08-14'
output: html_document
---
```{r libraries, include = FALSE}
options(stringsAsFactors = F)

# Überprüfen, ob die Packages bereits installiert sin
if(!require(readr)){
  # wenn es nicht installiert ist, wird es nun installiert
  install.packages("readr", dependencies = TRUE)
  library(readr)
}


if(!require(tidyverse)){
  install.packages("tidyverse")
  library(tidyverse)
}


if(!require(moments)){
  install.packages("moments")
  library("moments")
}
if(!require("plotly")){
  install.packages("plotly")
  library(plotly)
}

if (!require("data.table")) {
  install.packages("data.table")
  library(data.table)
}
library(plotly)
library(modelr)
```

```{r}
final_dataset = read_delim("Final_dataset_group_07.csv") %>% rename(vehicles_sold = 'Number of Vehicle')
```

```{r}
oem1 = final_dataset %>% filter(Herstellernummer == 1) 
oem2 = final_dataset %>% filter(Herstellernummer == 2) 

oem1_daily = oem1 %>% group_by(Zulassung, Herstellernummer) %>% summarize(vehicles_sold = sum(vehicles_sold)) %>% mutate(type = "train")
oem2_daily = oem2 %>% group_by(Zulassung, Herstellernummer) %>% summarize(vehicles_sold = sum(vehicles_sold)) %>% mutate(type = "train")

oem1_weeky= oem1 %>% group_by(Zulassung, Herstellernummer) %>% summarize(vehicles_sold = sum(vehicles_sold)) %>% mutate(type = "train")
oem2_weekly = oem2 %>% group_by(Zulassung, Herstellernummer) %>% summarize(vehicles_sold = sum(vehicles_sold)) %>% mutate(type = "train")

oem1_monthly = oem1 %>% group_by(Zulassung, Herstellernummer) %>% summarize(vehicles_sold = sum(vehicles_sold)) %>% mutate(type = "train")
oem2_monthly = oem2 %>% group_by(Zulassung, Herstellernummer) %>% summarize(vehicles_sold = sum(vehicles_sold)) %>% mutate(type = "train")

lmmodel1_daily = lm(vehicles_sold ~ Zulassung, data = oem1_daily)
lmmodel2_daily = lm(vehicles_sold ~ Zulassung, data = oem2_daily)

```


```{r}
#Generate days for the Q1 of 2017 and make predictions
dates2017 = seq(ISOdate(2017,1,1),ISOdate(2017,4,1),by = "day")
#Make a df from it for OEM1
df2017_1 = data.frame(Zulassung = as.Date(dates2017))
df2017_1 = df2017_1 %>% add_predictions(lmmodel1_daily) %>% mutate(Herstellernummer = 1,type = "linear_model") %>% rename(vehicles_sold = pred) 

#Make a df from it for OEM2
df2017_2 = data.frame(Zulassung = as.Date(dates2017))
df2017_2 = df2017_2 %>% add_predictions(lmmodel2_daily) %>% mutate(Herstellernummer = 2,type = "linear_model") %>% rename(vehicles_sold = pred) 


daily_result = rbind(oem1_daily,oem2_daily,df2017_1,df2017_2)

#To draw lines
predictions_1 = oem1_daily  %>% add_predictions(lmmodel1_daily) %>% select(-vehicles_sold) %>% rename(vehicles_sold = pred) %>%
  mutate(type = "predict")
predictions_2 = oem2_daily  %>% add_predictions(lmmodel2_daily) %>% select(-vehicles_sold) %>% rename(vehicles_sold = pred) %>%
  mutate(type = "predict")

daily_result = rbind(daily_result,predictions_1,predictions_2)

ggplot(data = daily_result)+
  geom_point(aes(x = Zulassung,y = vehicles_sold,color = type))+
  geom_vline(aes(xintercept = as.numeric(as.Date(ISOdate(2017,1,1)))))+
  facet_grid(Herstellernummer~.)

# #Make a df from it for OEM2
# df2017_1 = data.frame(Zulassung = as.Date(dates2017))
# df2017_1 = df2017_1 %>% add_predictions(lmmodel_daily) %>% mutate(Herstellernummer = 1)
# 
# ggplot(data = oem1_daily, aes(Zulassung,vehicles_sold))+
#   geom_point()+
#   geom_point(data = df2017_1, aes(Zulassung,pred), color = "red")+
#   geom_line(data = fortify(lmmodel_daily), aes(x = Zulassung, y = .fitted),color = "red")+
#   ggtitle("Linear regression for OEM1 based on daily basis")

```

```{r}
ggplot(oem2_daily,aes(Zulassung,vehicles_sold))+geom_point()

```